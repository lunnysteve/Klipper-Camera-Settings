[gcode_shell_command camera_ctrl_cmd]
command: /home/voron/camera-settings/scripts/camera_control.py
timeout: 5.0
verbose: False

[gcode_macro CAMERA_CONTROL]
description: Control camera settings. Usage: CAMERA_CONTROL ACTION=[get|set|restore] CONTROL=[name] VALUE=[value]
gcode:
    {% set action = params.ACTION|default("get") %}
    {% set control = params.CONTROL|default("") %}
    {% set value = params.VALUE|default("") %}
    {% set device = params.DEVICE|default("/dev/video0") %}
    
    {% if action == "list" %}
        RUN_SHELL_COMMAND CMD=camera_ctrl_cmd PARAMS="list"
    {% elif action == "set" %}
        RUN_SHELL_COMMAND CMD=camera_ctrl_cmd PARAMS="set {device} {control} {value}"
    {% elif action == "restore" %}
        RUN_SHELL_COMMAND CMD=camera_ctrl_cmd PARAMS="restore"
    {% elif action == "get" %}
        RUN_SHELL_COMMAND CMD=camera_ctrl_cmd PARAMS="get {device}"
    {% else %}
        {action_respond_info("Unknown Action for CAMERA_CONTROL")}
    {% endif %}

[delayed_gcode restore_camera_settings]
initial_duration: 5.0
gcode:
    CAMERA_CONTROL ACTION=restore
